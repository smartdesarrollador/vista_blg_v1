<!-- Blog Tag Page Container -->
<div class="blog-tag-page min-h-screen bg-gray-50 dark:bg-gray-900">
  <!-- Breadcrumb Navigation -->
  <div
    class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700"
  >
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
      <app-breadcrumb [customItems]="breadcrumbs()"></app-breadcrumb>
    </div>
  </div>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Loading State -->
    @if (loading()) {
    <div class="tag-loading">
      <!-- Header Skeleton -->
      <div class="animate-pulse mb-8">
        <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm">
          <div class="flex items-center gap-4 mb-4">
            <div
              class="w-12 h-12 bg-gray-300 dark:bg-gray-600 rounded-full"
            ></div>
            <div class="flex-1">
              <div
                class="h-6 bg-gray-300 dark:bg-gray-600 rounded w-1/3 mb-2"
              ></div>
              <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-1/2"></div>
            </div>
          </div>
          <div
            class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-full mb-2"
          ></div>
          <div class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-3/4"></div>
        </div>
      </div>

      <!-- Posts Grid Skeleton -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        @for (item of [1,2,3,4,5,6]; track item) {
        <div class="animate-pulse">
          <div class="bg-white dark:bg-gray-800 rounded-lg p-6 shadow-sm">
            <div class="h-40 bg-gray-300 dark:bg-gray-600 rounded mb-4"></div>
            <div
              class="h-4 bg-gray-300 dark:bg-gray-600 rounded w-3/4 mb-2"
            ></div>
            <div
              class="h-3 bg-gray-300 dark:bg-gray-600 rounded w-full mb-2"
            ></div>
            <div class="h-3 bg-gray-300 dark:bg-gray-600 rounded w-1/2"></div>
          </div>
        </div>
        }
      </div>
    </div>
    }

    <!-- Error State -->
    @else if (error()) {
    <div class="error-state text-center py-16">
      <div class="max-w-md mx-auto">
        <svg
          class="w-20 h-20 mx-auto text-red-400 dark:text-red-500 mb-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="1.5"
            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"
          ></path>
        </svg>
        <h2 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
          {{ error() }}
        </h2>
        <p class="text-gray-600 dark:text-gray-400 mb-8">
          El tag que buscas no existe o ha ocurrido un error al cargar el
          contenido.
        </p>
        <div class="space-y-4">
          <button
            (click)="goBackToBlog()"
            class="w-full sm:w-auto inline-flex items-center justify-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200"
          >
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path
                fill-rule="evenodd"
                d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
                clip-rule="evenodd"
              ></path>
            </svg>
            Volver al Blog
          </button>
        </div>
      </div>
    </div>
    }

    <!-- Content -->
    @else if (tagData()) {
    <!-- Tag Header -->
    <section
      class="tag-header bg-white dark:bg-gray-800 rounded-lg shadow-sm p-6 mb-8"
    >
      <div
        class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6"
      >
        <div class="flex-1">
          <!-- Tag Title and Info -->
          <div class="flex items-center gap-4 mb-4">
            <!-- Tag Badge -->
            <div class="flex items-center gap-3">
              <div
                class="w-12 h-12 rounded-full flex items-center justify-center text-white font-bold text-lg"
                [style.background-color]="tagData()?.color || '#6b7280'"
              >
                {{ tagData()?.tag?.charAt(0)?.toUpperCase() || "T" }}
              </div>
              <div>
                <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
                  {{ tagData()?.tag }}
                </h1>
                <p
                  class="text-gray-600 dark:text-gray-400 flex items-center gap-2 mt-1"
                >
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                    <path
                      fill-rule="evenodd"
                      d="M4 4a2 2 0 00-2 2v8a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2H4zm0 2h12v8H4V6z"
                      clip-rule="evenodd"
                    ></path>
                  </svg>
                  {{ totalPosts() }} artículo{{ totalPosts() !== 1 ? "s" : "" }}
                </p>
              </div>
            </div>
          </div>

          <!-- Tag Description -->
          <p
            class="text-gray-700 dark:text-gray-300 text-lg leading-relaxed mb-6"
          >
            {{ tagData()?.description }}
          </p>

          <!-- Related Tags -->
          @if (relatedTags().length > 0) {
          <div class="related-tags">
            <h3
              class="text-sm font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide mb-3"
            >
              Tags relacionados
            </h3>
            <div class="flex flex-wrap gap-2">
              @for (relatedTag of relatedTags(); track relatedTag) {
              <button
                (click)="onRelatedTagClick(relatedTag)"
                class="inline-flex items-center px-3 py-1.5 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-sm font-medium rounded-full hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200"
              >
                <svg
                  class="w-3 h-3 mr-1"
                  fill="currentColor"
                  viewBox="0 0 20 20"
                >
                  <path
                    fill-rule="evenodd"
                    d="M17.707 9.293a1 1 0 010 1.414l-7 7a1 1 0 01-1.414 0l-7-7A.997.997 0 012 10V5a3 3 0 013-3h5c.256 0 .512.098.707.293l7 7zM5 6a1 1 0 100-2 1 1 0 000 2z"
                    clip-rule="evenodd"
                  ></path>
                </svg>
                {{ relatedTag }}
              </button>
              }
            </div>
          </div>
          }
        </div>

        <!-- Actions -->
        <div class="flex flex-col sm:flex-row gap-3 lg:flex-col lg:items-end">
          <!-- Share Button -->
          <button
            (click)="shareTag()"
            class="inline-flex items-center justify-center px-4 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 font-medium rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors duration-200"
          >
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path
                d="M15 8a3 3 0 10-2.977-2.63l-4.94 2.47a3 3 0 100 4.319l4.94 2.47a3 3 0 10.895-1.789l-4.94-2.47a3.027 3.027 0 000-.74l4.94-2.47C13.456 7.68 14.19 8 15 8z"
              ></path>
            </svg>
            Compartir
          </button>

          <!-- Back to Blog -->
          <button
            (click)="goBackToBlog()"
            class="inline-flex items-center justify-center px-4 py-2 text-gray-600 dark:text-gray-400 font-medium rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200"
          >
            <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
              <path
                fill-rule="evenodd"
                d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
                clip-rule="evenodd"
              ></path>
            </svg>
            Volver al Blog
          </button>
        </div>
      </div>
    </section>

    <!-- Controls Section -->
    <section class="controls-section mb-8">
      <div
        class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm"
      >
        <!-- Results Info -->
        <div class="flex items-center gap-2 text-gray-600 dark:text-gray-400">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
              clip-rule="evenodd"
            ></path>
          </svg>
          <span class="text-sm font-medium">
            {{ totalPosts() }} artículo{{
              totalPosts() !== 1 ? "s" : ""
            }}
            encontrado{{ totalPosts() !== 1 ? "s" : "" }}
          </span>
        </div>

        <!-- Sort Dropdown -->
        <div class="flex items-center gap-2">
          <label
            for="sort-posts"
            class="text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap"
          >
            Ordenar por:
          </label>
          <select
            id="sort-posts"
            [value]="sortBy()"
            (change)="onSortChange($any($event.target).value)"
            class="text-sm border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1.5 bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"
          >
            @for (option of sortOptions; track option.value) {
            <option [value]="option.value">{{ option.label }}</option>
            }
          </select>
        </div>
      </div>
    </section>

    <!-- Posts Grid -->
    <section class="posts-section">
      @if (posts().length === 0) {
      <!-- Empty State -->
      <div class="empty-posts text-center py-16">
        <svg
          class="w-16 h-16 mx-auto text-gray-400 dark:text-gray-500 mb-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="1.5"
            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
          ></path>
        </svg>
        <h3 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">
          No hay artículos disponibles
        </h3>
        <p class="text-gray-600 dark:text-gray-400 mb-8">
          Aún no hay artículos publicados con el tag "{{ tagData()?.tag }}".
        </p>
        <button
          (click)="goBackToBlog()"
          class="inline-flex items-center px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-lg transition-colors duration-200"
        >
          <svg class="w-4 h-4 mr-2" fill="currentColor" viewBox="0 0 20 20">
            <path
              fill-rule="evenodd"
              d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z"
              clip-rule="evenodd"
            ></path>
          </svg>
          Explorar todos los artículos
        </button>
      </div>
      } @else {
      <!-- Posts Grid -->
      <div
        class="posts-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"
      >
        @for (post of posts(); track trackByPostId($index, post)) {
        <app-blog-card [post]="post" (postClicked)="onPostClick(post)">
        </app-blog-card>
        }
      </div>

      <!-- Pagination -->
      @if (pagination().totalPages > 1) {
      <div class="pagination-section">
        <app-blog-pagination
          [pagination]="pagination()"
          (pageChanged)="onPageChange($any($event))"
        >
        </app-blog-pagination>
      </div>
      } }
    </section>
    }
  </main>

  <!-- Tag Analytics (only visible in development or admin mode) -->
  @if (tagData() && false) {
  <aside
    class="bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 py-8"
  >
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
        Estadísticas del Tag
      </h3>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <div class="stat-card bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
          <div class="text-2xl font-bold text-blue-600 dark:text-blue-400">
            {{ totalPosts() }}
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400">
            Total de artículos
          </div>
        </div>
        <div class="stat-card bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
          <div class="text-2xl font-bold text-green-600 dark:text-green-400">
            {{ relatedTags().length }}
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400">
            Tags relacionados
          </div>
        </div>
        <div class="stat-card bg-gray-50 dark:bg-gray-700 rounded-lg p-4">
          <div class="text-2xl font-bold text-purple-600 dark:text-purple-400">
            {{ tagData()?.category || "N/A" }}
          </div>
          <div class="text-sm text-gray-600 dark:text-gray-400">Categoría</div>
        </div>
      </div>
    </div>
  </aside>
  }
</div>
