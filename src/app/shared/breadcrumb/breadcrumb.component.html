<!-- ===== BREADCRUMB COMPONENT ===== -->
<nav
  *ngIf="hasMultipleItems()"
  class="breadcrumb-container"
  [class.breadcrumb-loading]="isLoading()"
  [class.breadcrumb-compact]="
    breadcrumbConfig().compactOnMobile && isResponsiveBreakpoint()
  "
  aria-label="Breadcrumb"
  role="navigation"
>
  <!-- Skeleton loader mientras carga -->
  <div
    *ngIf="isLoading()"
    class="breadcrumb-skeleton animate-pulse flex items-center space-x-2"
  >
    <div
      class="skeleton-item h-4 bg-gray-200 dark:bg-gray-700 rounded w-16"
    ></div>
    <div
      class="skeleton-separator h-4 w-2 bg-gray-200 dark:bg-gray-700 rounded"
    ></div>
    <div
      class="skeleton-item h-4 bg-gray-200 dark:bg-gray-700 rounded w-20"
    ></div>
    <div
      class="skeleton-separator h-4 w-2 bg-gray-200 dark:bg-gray-700 rounded"
    ></div>
    <div
      class="skeleton-item h-4 bg-gray-200 dark:bg-gray-700 rounded w-24"
    ></div>
  </div>

  <!-- Breadcrumb principal -->
  <ol
    *ngIf="!isLoading()"
    class="breadcrumb-list flex items-center space-x-1 md:space-x-2 text-sm font-medium"
    vocab="https://schema.org/"
    typeof="BreadcrumbList"
  >
    <li
      *ngFor="
        let item of visibleItems();
        trackBy: trackByBreadcrumb;
        let first = first;
        let last = last;
        let index = index
      "
      class="breadcrumb-item flex items-center"
      [class.breadcrumb-item-first]="first"
      [class.breadcrumb-item-last]="last"
      [class.breadcrumb-item-active]="item.isActive"
      [class.breadcrumb-item-clickable]="item.isClickable"
      [class.breadcrumb-item-ellipsis]="item.label === '...'"
      property="itemListElement"
      typeof="ListItem"
    >
      <!-- Separador (no mostrar antes del primer elemento) -->
      <span
        *ngIf="!first"
        class="breadcrumb-separator mx-1 md:mx-2 text-gray-400 dark:text-gray-500"
        [class.separator-arrow]="breadcrumbConfig().separator === 'arrow'"
        [class.separator-chevron]="breadcrumbConfig().separator === 'chevron'"
        [class.separator-slash]="breadcrumbConfig().separator === 'slash'"
        aria-hidden="true"
      >
        <!-- Separador con SVG -->
        <svg
          *ngIf="breadcrumbConfig().separator !== 'custom'"
          class="separator-icon h-4 w-4 flex-shrink-0"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            [attr.d]="getSeparatorIcon()"
          ></path>
        </svg>

        <!-- Separador personalizado -->
        <span
          *ngIf="breadcrumbConfig().separator === 'custom'"
          class="separator-custom"
        >
          {{ breadcrumbConfig().customSeparator || "/" }}
        </span>
      </span>

      <!-- Elemento breadcrumb -->
      <div class="breadcrumb-content flex items-center space-x-1 md:space-x-2">
        <!-- Enlace clickeable -->
        <a
          *ngIf="item.isClickable; else nonClickableItem"
          [routerLink]="item.url"
          (click)="onItemClick(item, $event)"
          class="breadcrumb-link flex items-center space-x-1 text-gray-600 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 focus:text-blue-600 dark:focus:text-blue-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-md px-1 py-0.5 transition-colors duration-200"
          [attr.aria-label]="'Ir a ' + item.label"
          property="item"
          typeof="WebPage"
        >
          <!-- Icono del item -->
          <svg
            *ngIf="breadcrumbConfig().showIcons && getItemIcon(item)"
            class="breadcrumb-icon h-4 w-4 flex-shrink-0"
            [class.icon-home]="item.type === 'home'"
            [class.icon-category]="item.type === 'category'"
            [class.icon-post]="item.type === 'post'"
            [class.icon-page]="item.type === 'page'"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              [attr.d]="getItemIcon(item)"
            ></path>
          </svg>

          <!-- Texto del enlace -->
          <span
            class="breadcrumb-text truncate"
            [class.text-compact]="
              breadcrumbConfig().compactOnMobile && isResponsiveBreakpoint()
            "
            property="name"
          >
            <span
              class="hidden md:inline"
              *ngIf="breadcrumbConfig().compactOnMobile"
            >
              {{ item.label }}
            </span>
            <span class="md:hidden" *ngIf="breadcrumbConfig().compactOnMobile">
              {{ getCompactLabel(item.label, 15) }}
            </span>
            <span *ngIf="!breadcrumbConfig().compactOnMobile">
              {{ item.label }}
            </span>
          </span>

          <!-- Metadata estructurada -->
          <meta property="position" [attr.content]="index + 1" />
        </a>

        <!-- Elemento no clickeable (página actual o ellipsis) -->
        <ng-template #nonClickableItem>
          <span
            class="breadcrumb-current flex items-center space-x-1"
            [class.breadcrumb-ellipsis-text]="item.label === '...'"
            [class.text-gray-900]="item.isActive && item.label !== '...'"
            [class.dark:text-gray-100]="item.isActive && item.label !== '...'"
            [class.text-gray-500]="item.label === '...'"
            [class.dark:text-gray-400]="item.label === '...'"
            [attr.aria-current]="item.isActive ? 'page' : null"
            property="name"
          >
            <!-- Icono para elemento activo -->
            <svg
              *ngIf="
                breadcrumbConfig().showIcons &&
                getItemIcon(item) &&
                item.label !== '...'
              "
              class="breadcrumb-icon h-4 w-4 flex-shrink-0"
              [class.icon-active]="item.isActive"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                [attr.d]="getItemIcon(item)"
              ></path>
            </svg>

            <!-- Texto del elemento actual -->
            <span
              class="breadcrumb-text truncate font-semibold"
              [class.text-compact]="
                breadcrumbConfig().compactOnMobile && isResponsiveBreakpoint()
              "
              *ngIf="item.label !== '...'"
            >
              <span
                class="hidden md:inline"
                *ngIf="breadcrumbConfig().compactOnMobile"
              >
                {{ item.label }}
              </span>
              <span
                class="md:hidden"
                *ngIf="breadcrumbConfig().compactOnMobile"
              >
                {{ getCompactLabel(item.label, 15) }}
              </span>
              <span *ngIf="!breadcrumbConfig().compactOnMobile">
                {{ item.label }}
              </span>
            </span>

            <!-- Ellipsis especial -->
            <span
              *ngIf="item.label === '...'"
              class="breadcrumb-ellipsis-dots text-lg font-bold select-none"
              aria-label="Más elementos"
            >
              ...
            </span>

            <!-- Metadata estructurada para elemento activo -->
            <meta
              *ngIf="item.isActive"
              property="position"
              [attr.content]="index + 1"
            />
          </span>
        </ng-template>
      </div>
    </li>
  </ol>

  <!-- Información adicional (opcional) -->
  <div
    *ngIf="!isLoading() && breadcrumbConfig().enableClickTracking"
    class="breadcrumb-info mt-1 text-xs text-gray-500 dark:text-gray-400 hidden lg:block"
  >
    <span class="sr-only">Navegación:</span>
    {{ visibleItems().length }}
    {{ visibleItems().length === 1 ? "nivel" : "niveles" }}
  </div>
</nav>

<!-- Breadcrumb móvil compacto (alternativo) -->
<nav
  *ngIf="
    hasMultipleItems() &&
    breadcrumbConfig().compactOnMobile &&
    isResponsiveBreakpoint()
  "
  class="breadcrumb-mobile lg:hidden bg-gray-50 dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700 py-2 px-4"
  aria-label="Navegación móvil"
>
  <div class="flex items-center justify-between">
    <!-- Botón de retroceso -->
    <button
      *ngIf="visibleItems().length > 1"
      type="button"
      (click)="onItemClick(visibleItems()[visibleItems().length - 2])"
      class="mobile-back-button flex items-center space-x-2 text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 rounded-md px-2 py-1 transition-colors"
    >
      <svg
        class="h-4 w-4"
        fill="none"
        stroke="currentColor"
        viewBox="0 0 24 24"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M15 19l-7-7 7-7"
        />
      </svg>
      <span class="text-sm font-medium">Atrás</span>
    </button>

    <!-- Página actual -->
    <div class="mobile-current flex-1 text-right">
      <span
        class="text-sm font-semibold text-gray-900 dark:text-gray-100 truncate"
      >
        {{ visibleItems()[visibleItems().length - 1]?.label }}
      </span>
    </div>
  </div>
</nav>

<!-- Datos estructurados ocultos -->
<script
  *ngIf="shouldShowStructuredData() && structuredData()"
  type="application/ld+json"
  [innerHTML]="structuredData() | json"
></script>
